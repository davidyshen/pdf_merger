<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs" xmlns:ui="http://wixtoolset.org/schemas/v4/wxs/ui">
  <Package Name="PDF Merger" 
           Manufacturer="Developer" 
           Version="1.0.0.0" 
           UpgradeCode="a1b2c3d4-e5f6-4a5b-8c9d-0e1f2a3b4c5d"
           Language="1033">
    
    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />

    <MediaTemplate EmbedCab="yes" />

    <Feature Id="Main">
      <ComponentGroupRef Id="AppFiles" />
      <ComponentRef Id="ContextMenuRegistry" />
      <ComponentRef Id="ApplicationShortcut" />
    </Feature>

    <StandardDirectory Id="ProgramFiles64Folder">
      <Directory Id="INSTALLFOLDER" Name="PDFMerger" />
    </StandardDirectory>

    <StandardDirectory Id="ProgramMenuFolder">
      <Directory Id="ApplicationProgramsFolder" Name="PDF Merger"/>
    </StandardDirectory>

    <DirectoryRef Id="INSTALLFOLDER">
      <!-- The actual files will be harvested or listed here. 
           For simplicity in this script, we point to the main exe. -->
      <Component Id="MainExecutable" Guid="*">
        <File Id="PDFMergerEXE" Source="bin\ARM64\Release\net8.0-windows10.0.22621.0\win-arm64\publish\PDFMerger.exe" KeyPath="yes" />
      </Component>
    </DirectoryRef>

    <DirectoryRef Id="ApplicationProgramsFolder">
      <Component Id="ApplicationShortcut" Guid="*">
        <Shortcut Id="ApplicationStartMenuShortcut" 
                  Name="PDF Merger" 
                  Description="Merges PDF files"
                  Target="[#PDFMergerEXE]"
                  WorkingDirectory="INSTALLFOLDER"/>
        <RemoveFolder Id="CleanUpShortCut" Directory="ApplicationProgramsFolder" On="uninstall"/>
        <RegistryValue Root="HKCU" Key="Software\Developer\PDFMerger" Name="installed" Type="integer" Value="1" KeyPath="yes"/>
      </Component>
    </DirectoryRef>

    <Component Id="ContextMenuRegistry" Guid="*" Directory="INSTALLFOLDER">
      <RegistryKey Root="HKCU" Key="Software\Classes\*\shell\MergePDFs">
        <RegistryValue Type="string" Value="Merge PDFs" />
        <RegistryValue Name="Icon" Type="string" Value="[#PDFMergerEXE]" />
        <RegistryKey Key="command">
          <RegistryValue Type="string" Value="&quot;[#PDFMergerEXE]&quot; &quot;%1&quot;" />
        </RegistryKey>
      </RegistryKey>
    </Component>

    <!-- UI for the installer -->
    <ui:WixUI Id="WixUI_InstallDir" InstallDirectory="INSTALLFOLDER" />
  </Package>

  <Fragment>
    <ComponentGroup Id="AppFiles">
      <ComponentRef Id="MainExecutable" />
      <!-- In a real scenario, you'd use 'wix harvest' to get all DLLs, 
           but for this example, we'll assume the user knows they need to include all files. -->
    </ComponentGroup>
  </Fragment>
</Wix>
